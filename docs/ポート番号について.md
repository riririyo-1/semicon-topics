# ポート番号について

## ■ 基本ルール

Docker コンテナ内とホストのポート番号について

### コンテナ内ポート
>  - アプリケーションが使用したい番号に依存する
>  - (例：Expressは4000番、Next.jsは3000番)
>  - むやみに変更しない

### ホスト側ポート
>  - 競合しないようにズラして割り当てる
>  - 複数サービスが同時走る場合は特に重要


---

## ■ 利用する番号帯の基本断り

| 番号帯 | 用途 |
|:---|:---|
| 1~1023 | システムポート (HTTP:80, HTTPS:443, SSH:22等) -> 利用禁止 |
| 1024~49151 | 一般ユーザーアプリ用ポート帯 **(これを使う)** |
| 49152~65535 | 動的、プライベートポート帯 |


---

## ■ ベストプラクティス

| サービス | ホスト側ポート | コンテナ内ポート |
|:---|:---|:---|
| frontend (Next.js) | 3000 | 3000 |
| backend (Express)  | 4000 | 4000 |
| api (APIサービス) | 4001 | 4000 (内部は同じ、ホストだけズラす) |
| pipeline (batch)   | 8000 | 8000 |


---

## ■ これを実現するDocker Compose例

```yaml
db:
  ports:
    - "5432:5432"

backend:
  ports:
    - "4000:4000"

api:
  ports:
    - "4001:4000"

frontend:
  ports:
    - "3000:3000"

pipeline:
  ports:
    - "8000:8000"
```


---

